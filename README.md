# PHP class fuzzer
This is a fuzzer for PHP classes. It can be used to find bugs by [fuzzing](https://en.wikipedia.org/wiki/Fuzzing) it



# Installation
`composer require sergey-bel/php-classfuzz`


# Overview
Fuzzer generates a lot of inputs and runs the needed code with these inputs. Fuzzer analyzes executions results and reports if something went wrong (f.e. unexpected exception or php error are thrown)  
First fuzzer generates corpus - set of initial data  
Then it applyes some mutators to data from corpus to get different inputs for fuzzing



# Usage
To get started fuzzing a class you need to create Fuzz-class:

* class must be called `...Fuzz`
* class must extend `BaseFuzz` abstract class
* `fuzz` method must be implemented in the class
* `getArguments()` method must be implemented in the class


Example (class file in 'fuzzing' directory):
```php
class SimpleFuzz extends BaseFuzz
{
    // describe arguments for fuzz() method
    public function getArguments(): Arguments
    {
       
        $args = new Arguments();
        $args->setArgument(0, new Argument(
            // set corpus data
            // data can be set manually or by using some prepared helpers
            // in this example `CharStringCorpus` is used to generate corpus 
            CorpusGeneratorFacade::getGenerator(CharStringCorpus::class)->generate(100),
            // set mutators
            StringMutatorFacade::getAllMutators(),
        ));

        return $args;
    }

    // set expectations about exceptions
    public function getExceptionCatchers(): array
    {
        // some exception can be unexpected and treated as fuzzer findings but other can be ignored
        // f.e. `AllowedExceptionListCatcher` define a list of allowed (ignored) exceptions
        // in this example all exceptions will be treated as fuzzing finding
        return [
            new AllowedExceptionListCatcher([]),
        ];
    }

    // set maximum count of `fuzz` method call
    public function getMaxCount(): int
    {
        return 100000;
    }

    // main method in fuzzing process
    // this method will be called with different inputs
    // arguments will be generated by settings from `getArguments` method
    // you can write here any logic for fuzzing
    public function fuzz(string $text)
    {
        if (strlen($text) > 50) {
            throw new Exception();
        }
    }
}
```

then run command `vendor/bin/php-classfuzz fuzzing --dir=fuzzing`

# Main concepts

## Corpus
Corpus is a set of initial data for fuzzing. This data will then be mutated to get fuzzing inputs. To simplify the creation of Corpus for common cases some special generators are implemented  
Generator classes must implement `GeneratorInterface`


## Mutators
Data from corpus are mutated by Mutators classes  
Mutator classes must implement `MutatorInterface`

## ExceptionCatchers
Exceptions catchers are used to analyze thrown exceptions. Some exceptions may be the expected result when calling class methods on corpus data, and some may not. Exceptions catchers are needed to manage this  
ExceptionCatcher classes must implement `ExceptionCatcherInterface`

## PostConditions
Post conditions are used to check the result of a `fuzz` method call. If some conditions need to be met for the results of the `fuzz` method they can be checked in PostCondition classes  
PostCondition classes must implement `PostConditionInterface`
